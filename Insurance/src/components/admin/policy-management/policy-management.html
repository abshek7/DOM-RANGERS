<div class="p-6">
  <div class="flex gap-3 mb-6">
    <button
      class="px-4 py-2 rounded border"
      [class.bg-indigo-600]="activeTab==='policies'"
      [class.text-white]="activeTab==='policies'"
      (click)="activeTab='policies'">
      Policies
    </button>

    <button
      class="px-4 py-2 rounded border"
      [class.bg-indigo-600]="activeTab==='requests'"
      [class.text-white]="activeTab==='requests'"
      (click)="activeTab='requests'">
      Policy Requests
    </button>
  </div>
  @if (activeTab === 'policies') {
  <div class="bg-white border rounded-xl p-6 mb-8">
    <h2 class="text-lg font-semibold mb-4">Add New Policy</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input class="border rounded p-2" placeholder="Policy Name" [(ngModel)]="policy.name">
      <select class="border rounded p-2" [(ngModel)]="policy.type">
        <option value="">Select Type</option>
        <option value="health">Health</option>
        <option value="life">Life</option>
        <option value="vehicle">Vehicle</option>
        <option value="travel">Travel</option>
      </select>

      <input class="border rounded p-2" type="number" placeholder="Premium" [(ngModel)]="policy.premium">
      <input class="border rounded p-2" type="number" placeholder="Coverage" [(ngModel)]="policy.coverage">

      <input class="border rounded p-2" type="number" placeholder="Duration (years)" [(ngModel)]="policy.duration">

      <textarea class="border rounded p-2 md:col-span-2" rows="2"
        placeholder="Description"
        [(ngModel)]="policy.description"></textarea>

      <textarea class="border rounded p-2 md:col-span-2" rows="2"
        placeholder="Features (comma separated)"
        [(ngModel)]="policy.featuresText"></textarea>
    </div>

    <div class="flex justify-end mt-4">
      <button class="bg-indigo-600 text-white px-5 py-2 rounded" (click)="addPolicy()">
        Add Policy
      </button>
    </div>
  </div>
  <div class="bg-white border rounded-xl overflow-x-auto">
    <table class="w-full text-left">
      <thead class="bg-gray-50 border-b">
        <tr>
          <th class="p-4">ID</th>
          <th class="p-4">Name</th>
          <th class="p-4">Type</th>
          <th class="p-4">Premium</th>
          <th class="p-4">Coverage</th>
          <th class="p-4 text-center">Actions</th>
        </tr>
      </thead>

      <tbody>
        @for (p of policies; track $index) {
          <tr class="border-b">
            <td class="p-4">{{ p.id }}</td>
            <td class="p-4">{{ p.name }}</td>
            <td class="p-4">{{ p.type }}</td>
            <td class="p-4">₹{{ p.premium }}</td>
            <td class="p-4">₹{{ p.coverage }}</td>
            <td class="p-4 text-center space-x-2">
              <button class="px-3 py-1 border rounded" (click)="openEdit(p)">Edit</button>
              <button class="px-3 py-1 bg-red-600 text-white rounded"
                      (click)="deletePolicy(p.id)">Delete</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  }
  @if (activeTab === 'requests') {

  <div class="bg-white border rounded-xl overflow-x-auto">
    <table class="w-full text-left">
      <thead class="bg-gray-50 border-b">
        <tr>
          <th class="p-4">Customer</th>
          <th class="p-4">Policy</th>
          <th class="p-4">Status</th>
          <th class="p-4">Agent</th>
          <th class="p-4 text-center">Action</th>
        </tr>
      </thead>

      <tbody>
        @for (r of policyApplications(); track $index) {
          <tr class="border-b">
            <td class="p-4">{{ r.customerId }}</td>
            <td class="p-4">{{ r.policyId }}</td>
            <td class="p-4">{{ r.status }}</td>
            <td class="p-4">{{ r.assignedAgentId || '-' }}</td>
            <td class="p-4 text-center">
              <button class="px-3 py-1 bg-indigo-600 text-white rounded"
                      (click)="openAssign(r)">
                Assign Agent
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  }

</div>

@if (showEditModal) {
<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl p-6 w-full max-w-lg">

    <h3 class="text-lg font-semibold mb-4">Edit Policy</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input class="border rounded p-2" [(ngModel)]="selectedPolicy.name">
      <select class="border rounded p-2" [(ngModel)]="selectedPolicy.type">
        <option value="health">Health</option>
        <option value="life">Life</option>
        <option value="vehicle">Vehicle</option>
        <option value="travel">Travel</option>
      </select>

      <input class="border rounded p-2" type="number" [(ngModel)]="selectedPolicy.premium">
      <input class="border rounded p-2" type="number" [(ngModel)]="selectedPolicy.coverage">
      <input class="border rounded p-2" type="number" [(ngModel)]="selectedPolicy.duration">

      <textarea class="border rounded p-2 md:col-span-2"
        [(ngModel)]="selectedPolicy.description"></textarea>

      <textarea class="border rounded p-2 md:col-span-2"
        [(ngModel)]="selectedPolicy.featuresText"></textarea>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button class="px-4 py-2 border rounded" (click)="closeEdit()">Cancel</button>
      <button class="px-4 py-2 bg-indigo-600 text-white rounded"
              (click)="updatePolicy()">Update</button>
    </div>

  </div>
</div>
}
@if (showAssignModal) {
<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl p-6 w-full max-w-md">

    <h3 class="text-lg font-semibold mb-4">Assign Agent</h3>

    <select class="border p-2 rounded w-full" [(ngModel)]="selectedAgentId">
      <option value="">Select Agent</option>
      @for (a of agents; track $index) {
        <option [value]="a.id">{{ a.id }}</option>
      }
    </select>

    <div class="flex justify-end gap-3 mt-6">
      <button class="px-4 py-2 border rounded" (click)="closeAssign()">Cancel</button>
      <button class="px-4 py-2 bg-indigo-600 text-white rounded"
              (click)="assignAgent()">Assign</button>
    </div>

  </div>
</div>
}
